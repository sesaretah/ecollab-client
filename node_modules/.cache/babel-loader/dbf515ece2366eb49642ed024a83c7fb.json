{"ast":null,"code":"var _jsxFileName = \"/Users/hosseinshafiei/Projects/ecollab/client/src/components/rooms/janus-videoroom.js\";\nimport Janus from \"../../janus-2021.js\";\nimport React, { Component } from \"react\";\nimport $ from \"jquery\";\nimport { socket } from \"../../socket.js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function vsessionCreate(room) {\n  var self = this;\n  Janus.init({\n    debug: \"all\",\n    callback: function () {\n      // Create session\n      var janus = new Janus({\n        server: self.state.server,\n        success: function () {\n          // Attach to VideoRoom plugin\n          janus.attach({\n            plugin: \"janus.plugin.videoroom\",\n            opaqueId: self.state.opaqueId,\n            success: function (pluginHandle) {\n              //sfutest = pluginHandle;\n              self.setState({\n                janus: janus\n              });\n              self.setState({\n                sfutest: pluginHandle\n              });\n              Janus.log(\"Plugin attached! (\" + self.state.sfutest.getPlugin() + \", id=\" + self.state.sfutest.getId() + \")\");\n              Janus.log(\"  -- This is a publisher/manager\");\n              self.vregisterUsername(room);\n              initDevices(); // Prepare the username registration\n            },\n            error: function (error) {\n              Janus.error(\"  -- Error attaching plugin...\", error);\n            },\n            consentDialog: function (on) {\n              Janus.debug(\"Consent dialog should be \" + (on ? \"on\" : \"off\") + \" now\");\n            },\n            iceState: function (state) {\n              Janus.log(\"ICE state changed to \" + state);\n            },\n            mediaState: function (medium, on) {\n              Janus.log(\"Janus \" + (on ? \"started\" : \"stopped\") + \" receiving our \" + medium);\n            },\n            webrtcState: function (on) {\n              Janus.log(\"Janus says our WebRTC PeerConnection is \" + (on ? \"up\" : \"down\") + \" now\");\n            },\n            onmessage: function (msg, jsep) {\n              Janus.debug(\" ::: Got a message (publisher) :::\", msg);\n              var event = msg[\"videoroom\"];\n              Janus.debug(\"Event: \" + event);\n\n              if (event) {\n                if (event === \"joined\") {\n                  // Publisher/manager created, negotiate WebRTC and attach to existing feeds, if any\n                  //myid = msg[\"id\"];\n                  //mypvtid = msg[\"private_id\"];\n                  self.setState({\n                    myVroomId: msg[\"id\"],\n                    vJoined: true\n                  });\n                  Janus.log(\"Successfully joined room \" + msg[\"room\"] + \" with ID \" + msg[\"id\"]);\n                  self.addParticipant(msg[\"id\"], self.state.fullname + \"ยง\" + self.state.userUUID);\n\n                  if (self.state.reloadParams && self.state.reloadParams[\"cam\"]) {\n                    self.ionRequestRoom();\n                  } //publishOwnFeed(true);\n                  //}\n                  // Any new feed to attach to?\n\n\n                  if (msg[\"publishers\"]) {\n                    var list = msg[\"publishers\"];\n                    Janus.debug(\"Got a list of available publishers/feeds:\", list);\n\n                    for (var f in list) {\n                      console.log(\"List >>\", list);\n                      var id = list[f][\"id\"];\n                      var display = list[f][\"display\"];\n                      var audio = list[f][\"audio_codec\"];\n                      var video = list[f][\"video_codec\"];\n                      Janus.debug(\"  >> [\" + id + \"] \" + display + \" (audio: \" + audio + \", video: \" + video + \")\");\n                      self.vAddParticipant(list[f][\"id\"], list[f][\"display\"]);\n                      self.vNewRemoteFeed(id, display, audio, video);\n                    }\n                  }\n                } else if (event === \"destroyed\") {\n                  // The room has been destroyed\n                  Janus.warn(\"The room has been destroyed!\");\n                } else if (event === \"event\") {\n                  // Any new feed to attach to?\n                  if (msg[\"publishers\"]) {\n                    var list = msg[\"publishers\"];\n                    Janus.debug(\"Got a list of available publishers/feeds:\", list);\n\n                    for (var f in list) {\n                      var id = list[f][\"id\"];\n                      var display = list[f][\"display\"];\n                      var audio = list[f][\"audio_codec\"];\n                      var video = list[f][\"video_codec\"];\n                      console.log(list);\n                      Janus.debug(\"  >> [\" + id + \"] \" + display + \" (audio: \" + audio + \", video: \" + video + \")\");\n                      self.vAddParticipant(list[f][\"id\"], list[f][\"display\"]);\n                      self.vNewRemoteFeed(id, display, audio, video);\n                    }\n                  } else if (msg[\"leaving\"]) {\n                    // One of the publishers has gone away?\n                    var leaving = msg[\"leaving\"];\n                    console.log(\"Publisher leaving: \" + leaving);\n                    self.setState({\n                      feeds: self.state.feeds.filter(item => item.rfid != leaving)\n                    }, () => console.log(\"feeds: >>>>\", self.state.feeds));\n                    var unPublishedFeed = self.state.feeds.filter(item => item.rfid === leaving);\n                    var remoteFeed = unPublishedFeed.shift();\n\n                    if (remoteFeed != null) {\n                      remoteFeed.detach();\n                    }\n\n                    self.removeParticipant(leaving);\n                  } else if (msg[\"unpublished\"]) {\n                    // One of the publishers has unpublished?\n                    var unpublished = msg[\"unpublished\"];\n                    console.log(\"Publisher left: \" + unpublished);\n\n                    if (unpublished === \"ok\") {\n                      self.state.sfutest.hangup();\n                      self.vStreamDettacher(self.state.sfutest);\n                      return;\n                    }\n\n                    var unPublishedFeed = self.state.feeds.filter(item => item.rfid === unpublished);\n                    var remoteFeed = unPublishedFeed.shift();\n\n                    if (remoteFeed != null) {\n                      remoteFeed.detach();\n                      self.vStreamDettacher(remoteFeed);\n                    }\n\n                    self.removeParticipant(unpublished);\n                    self.setState({\n                      feeds: self.state.feeds.filter(item => item.rfid != unpublished)\n                    });\n                  } else if (msg[\"error\"]) {\n                    if (msg[\"error_code\"] === 426) {// This is a \"no such room\" error: give a more meaningful description\n                    } else {}\n                  }\n                }\n              }\n\n              if (jsep) {\n                Janus.debug(\"Handling SDP as well...\", jsep);\n                self.state.sfutest.handleRemoteJsep({\n                  jsep: jsep\n                });\n              }\n            },\n            onlocalstream: function (stream) {\n              Janus.debug(\" ::: Got a local stream :::\", stream);\n              console.log(\" ::: Got a local stream :::\", stream);\n              console.log(self.state.sfutest.id);\n              var exisiting = self.state.feeds.filter(item => item.id === self.state.sfutest.id);\n\n              if (exisiting.length === 0) {\n                self.state.sfutest.rfid = self.state.myVroomId;\n                self.setState({\n                  feeds: self.state.feeds.concat(self.state.sfutest)\n                });\n              }\n\n              var videoTracks = stream.getVideoTracks();\n\n              if (!videoTracks || videoTracks.length === 0) {\n                self.vStreamDettacher(self.state.sfutest);\n              } else {\n                console.log(self.state.vparticipants);\n                self.vStreamAttacher(self.state.sfutest);\n              }\n            },\n            onremotestream: function (stream) {// The publisher stream is sendonly, we don't expect anything here\n            },\n            oncleanup: function () {\n              Janus.log(\" ::: Got a cleanup notification: we are unpublished now :::\");\n            }\n          });\n        },\n        error: function (error) {\n          Janus.error(error); //bootbox.alert(error, function() {\n\n          var params = \"\";\n\n          if (self.state.publishedCamera) {\n            params = params + \"?cam=true&roomId=\" + self.state.slot;\n          }\n\n          if (!self.state.muted) {\n            params = params + \"&mic=true\";\n          }\n\n          if (params === \"\") {\n            var bar = self.getJsonFromUrl(self.$f7.view[0].history[0]);\n            params = params + \"?cam=\" + bar[\"cam\"] + \"&mic=\" + bar[\"mic\"];\n          } //console.log('%%%%%%%%%%%%%%%', params)\n\n\n          window.location.replace(\"http://localhost:3000/\" + params); //});\n        },\n        destroyed: function () {\n          window.location.reload();\n        }\n      });\n    }\n  });\n}\nexport function vNewRemoteFeed(id, feeds, display, audio, video) {\n  var self = this; // A new feed has been published, create a new plugin handle and attach to it as a subscriber\n\n  var remoteFeed = null;\n  self.state.janus.attach({\n    plugin: \"janus.plugin.videoroom\",\n    opaqueId: this.state.opaqueId,\n    success: function (pluginHandle) {\n      remoteFeed = pluginHandle;\n      remoteFeed.simulcastStarted = false;\n      Janus.log(\"Plugin attached! (\" + remoteFeed.getPlugin() + \", id=\" + remoteFeed.getId() + \")\");\n      Janus.log(\"  -- This is a subscriber\"); // We wait for the plugin to send us an offer\n\n      var subscribe = {\n        request: \"join\",\n        room: 1234,\n        ptype: \"subscriber\",\n        pin: self.state.pin,\n        feed: id,\n        private_id: self.state.mypvtid\n      }; // In case you don't want to receive audio, video or data, even if the\n      // publisher is sending them, set the 'offer_audio', 'offer_video' or\n      // 'offer_data' properties to false (they're true by default), e.g.:\n      // \t\tsubscribe[\"offer_video\"] = false;\n      // For example, if the publisher is VP8 and this is Safari, let's avoid video\n\n      if (Janus.webRTCAdapter.browserDetails.browser === \"safari\" && (video === \"vp9\" || video === \"vp8\" && !Janus.safariVp8)) {\n        if (video) video = video.toUpperCase();\n        console.log(\"Publisher is using \" + video + \", but Safari doesn't support it: disabling video\");\n        subscribe[\"offer_video\"] = false;\n      } //subscribe[\"offer_video\"] = false;\n      //remoteFeed.videoCodec = video;\n      //var participantId = display.split(\"ยง\")[1]\n      //var propagate = self.state.propagates.filter((item) => item === participantId)\n\n\n      if (feeds) {\n        //name should be display !!\n        var participantId = feeds.split(\"ยง\")[1];\n        var roomId = feeds.split(\"ยง\")[feeds.split(\"ยง\").length - 1];\n        var propagate = self.state.propagates.filter(item => item === participantId);\n        self.setState({\n          availableFeeds: self.state.availableFeeds.filter(item => item.id === id)\n        });\n        console.log(self.state.availableFeeds);\n\n        if (propagate && propagate[0] || roomId === \"0\") {\n          remoteFeed.send({\n            message: subscribe\n          });\n        } else {\n          self.setState({\n            availableFeeds: self.state.availableFeeds.concat({\n              id: id,\n              display: feeds,\n              uuid: participantId,\n              video: video\n            })\n          });\n        }\n      }\n    },\n    error: function (error) {\n      Janus.error(\"  -- Error attaching plugin...\", error);\n      window.alert(\"Error attaching plugin... \" + error);\n    },\n    onmessage: function (msg, jsep) {\n      Janus.debug(\" ::: Got a message (subscriber) :::\", msg);\n      var event = msg[\"videoroom\"];\n      Janus.log(\"Event: \" + event);\n\n      if (msg[\"error\"]) {\n        window.alert(msg[\"error\"]);\n      } else if (event) {\n        if (event === \"attached\") {\n          remoteFeed.rfid = msg[\"id\"];\n          remoteFeed.rfdisplay = msg[\"display\"];\n          self.setState({\n            feeds: self.state.feeds.concat(remoteFeed)\n          }, () => console.log(\"@@@@\", self.state.feeds));\n\n          if (!video) {\n            self.vStreamDettacher(remoteFeed);\n          }\n\n          Janus.log(\"Successfully attached to feed \" + remoteFeed.rfid + \" (\" + remoteFeed.rfdisplay + \") in room \" + msg[\"room\"]);\n        } else if (event === \"event\") {} else {// What has just happened?\n        }\n      }\n\n      if (jsep) {\n        Janus.log(\"Handling SDP as well...\", jsep);\n        remoteFeed.createAnswer({\n          jsep: jsep,\n          // Add data:true here if you want to subscribe to datachannels as well\n          // (obviously only works if the publisher offered them in the first place)\n          media: {\n            audioSend: false,\n            videoSend: false,\n            data: false\n          },\n          // We want recvonly audio/video\n          success: function (jsep) {\n            Janus.log(\"Got SDP!\", jsep);\n            var body = {\n              request: \"start\",\n              room: self.state.roomId\n            };\n            remoteFeed.send({\n              message: body,\n              jsep: jsep\n            });\n          },\n          error: function (error) {\n            Janus.log(\"WebRTC error:\", error);\n            window.alert(\"WebRTC error... \" + error.message);\n          }\n        });\n      }\n    },\n    iceState: function (state) {\n      Janus.log(\"ICE state of this WebRTC PeerConnection (feed #\" + remoteFeed.rfid + \") changed to \" + state);\n    },\n    webrtcState: function (on) {\n      Janus.log(\"Janus says this WebRTC PeerConnection (feed #\" + remoteFeed.rfid + \") is \" + (on ? \"up\" : \"down\") + \" now\");\n\n      if (on === \"down\") {\n        self.vremoveParticipant(remoteFeed.rfid);\n      }\n    },\n    onlocalstream: function (stream) {\n      console.log(\">>>>>>>>>>>\", stream);\n    },\n    onremotestream: function (stream) {\n      self.vStreamAttacher(remoteFeed);\n    },\n    ondata: function (data) {},\n    oncleanup: function () {\n      Janus.log(\" ::: Got a cleanup notification (remote feed \" + id + \") :::\");\n    }\n  });\n}\nexport function vregisterUsername(room) {\n  var self = this;\n  var register = {\n    request: \"join\",\n    room: 1234,\n    ptype: \"publisher\",\n    //pin: self.state.pin,\n    display: self.state.fullname + \" ยง\" + self.state.userUUID + \"ยง\" + self.state.userColor + \"ยง\" + self.state.slot\n  };\n  self.state.sfutest.send({\n    message: register\n  }); //self.setState({ myVroomId: self.state.mixertest.id });\n}\nexport function vChangeUsername(room) {\n  var self = this;\n  var register = {\n    request: \"configure\",\n    room: 1234,\n    ptype: \"publisher\",\n    //pin: self.state.pin,\n    display: self.state.fullname + \" ยง\" + self.state.userUUID + \"ยง\" + self.state.userColor + \"ยง\" + self.state.slot\n  };\n  self.state.sfutest.send({\n    message: register\n  }); //self.setState({ myVroomId: self.state.mixertest.id });\n}\nexport function vStreamAttacher(feed) {\n  var self = this;\n  console.log(\"Attaching \" + feed.id);\n  console.log($(\"#video-\" + feed.id));\n\n  if ($(\"#video-\" + feed.id).length == 0) {\n    var localVideo = document.createElement(\"video\");\n    localVideo.autoplay = true;\n    localVideo.muted = true;\n    localVideo.width = \"320\";\n    localVideo.id = \"video-\" + feed.id;\n  }\n\n  $(\"#video-\" + feed.id).show();\n\n  if (feed.id && feed.webrtcStuff && feed.webrtcStuff.remoteStream) {\n    self.setState({\n      vActive: true\n    });\n    if (localVideo) $(\"#remoteVideos\").append(localVideo);\n    Janus.attachMediaStream(document.getElementById(\"video-\" + feed.id), feed.webrtcStuff.remoteStream);\n  }\n\n  if (feed.id && feed.webrtcStuff && feed.webrtcStuff.myStream) {\n    if (localVideo) $(\"#selfVideos\").append(localVideo);\n    $(\"#videoLoaderIcon\").hide();\n    $(\"#videoLoaderIcon2\").hide();\n    $(\"#disableVideo\").show();\n    Janus.attachMediaStream(document.getElementById(\"video-\" + feed.id), feed.webrtcStuff.myStream);\n  }\n}\nexport function vStreamDettacher(feed) {\n  if (feed.id) {\n    console.log(\"Dettaching \" + feed.id);\n    $(\"#video-\" + feed.id).hide();\n  }\n}\nexport function vremoveParticipant(id) {\n  var self = this;\n  self.setState({\n    vparticipants: self.state.vparticipants.filter(item => item.id !== id)\n  });\n}\nexport function vAddParticipant(id, p) {\n  //console.log(\"Adding Participants ...\", id, p);\n  var self = this;\n  var participant = p.split(\"ยง\");\n\n  if (this.exisitingParticipant(participant[1])) {\n    self.setState({\n      vparticipants: self.state.vparticipants.concat({\n        id: id,\n        display: participant[0],\n        uuid: participant[1],\n        userColor: participant[2],\n        role: \"listener\",\n        current: \"stopped-talking\"\n      })\n    });\n  } //console.log(\"participant added:\", participant[1]);\n\n}\nexport function publishCamera(bitrate = 16, deviceId = null) {\n  var self = this;\n  var video = true;\n  var device = true;\n\n  if (!self.state.isAdmin) {\n    video = {\n      width: 180,\n      height: 151\n    };\n  }\n\n  if (self.state.slot === '0') {\n    video = \"hires-16:9\";\n  }\n\n  if (deviceId) {\n    device = {\n      deviceId: {\n        exact: deviceId\n      }\n    };\n  }\n\n  self.state.sfutest.createOffer({\n    media: {\n      audioRecv: false,\n      videoRecv: false,\n      data: false,\n      videoSend: true,\n      audioSend: false,\n      video: video,\n      video: device\n    },\n    success: function (jsep) {\n      Janus.debug(\"********* Got publisher SDP!\", jsep);\n      console.log(\"switching to \" + bitrate);\n\n      if (jsep) {\n        var publish = {\n          request: \"configure\",\n          audio: false,\n          video: true,\n          //video:{width: 180, height: 180},\n          data: false,\n          bitrate: bitrate * 8000,\n          bitrate_cap: true //videocodec: \"vp8\",\n\n        };\n        self.state.sfutest.send({\n          message: publish,\n          jsep: jsep\n        });\n      }\n\n      self.setState({\n        publishedCamera: true\n      });\n      self.$$(\"#disableVideo\").show();\n      self.$$(\"#dVideo\").show();\n      console.log(\"ID: >>>\", self.state.sfutest.id);\n      socket.emit(\"ionSetSlot\", {\n        slot: self.state.slot,\n        stream: self.state.sfutest.id\n      });\n      var tracks = self.state.sfutest.webrtcStuff.myStream.getTracks();\n      console.log(tracks);\n    },\n    error: function (error) {\n      Janus.error(\"***** WebRTC error:\", error);\n    }\n  });\n}\nexport function unPublishCamera() {\n  var self = this;\n  console.log(\"unPublishing ..\");\n  var unpublish = {\n    request: \"unpublish\"\n  };\n  self.state.sfutest.send({\n    message: unpublish\n  });\n  self.vStreamDettacher(self.state.sfutest);\n  console.log(\"ID: >>>\", self.state.sfutest.id);\n  socket.emit(\"ionRelSlot\", {\n    slot: self.state.slot,\n    stream: self.state.sfutest.id\n  });\n  self.setState({\n    publishedCamera: false,\n    videoState: \"initial\",\n    slot: null\n  });\n}\nexport function toggleVideoDevice(deviceId) {\n  var self = this;\n\n  if (self.state.publishedCamera) {\n    self.unPublishCamera();\n  }\n\n  self.publishCamera(16, deviceId);\n}\nexport function vexisitingParticipant(participantId) {\n  var self = this;\n  var exisiting = self.state.vparticipants.filter(item => item.uuid === participantId);\n\n  if (exisiting.length === 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\nexport function vparticipantDisplay(participantId) {\n  var self = this;\n  var exisiting = self.state.vparticipants.filter(item => item.uuid === participantId);\n\n  if (exisiting.length === 0) {\n    return \"\";\n  } else {\n    return exisiting[0].display;\n  }\n}\nexport function vparticipantChangeStatus(participantId, status) {\n  this.setState(prevState => ({\n    talking: { ...prevState.talking,\n      [participantId]: status\n    }\n  }));\n}\nexport function vparticipantChangeRoom(participantId, room) {\n  this.setState(prevState => ({\n    participantRoom: { ...prevState.participantRoom,\n      [participantId]: room\n    }\n  }));\n}\nexport function vexitAudioRoom() {\n  var self = this;\n\n  if (this.state.mixertest) {\n    this.state.mixertest.send({\n      message: {\n        request: \"unpublish\"\n      }\n    });\n  }\n}\nexport function vPublishBtn() {\n  var self = this;\n\n  if (!self.state.publishedCamera) {\n    return /*#__PURE__*/_jsxDEV(\"a\", {\n      id: \"enableVideo\",\n      fill: true,\n      onClick: () => self.ionRequestRoom(),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          float: \"right\",\n          paddingTop: \"3px\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"svg\", {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          class: \"icon\",\n          width: \"18\",\n          height: \"18\",\n          viewBox: \"0 0 24 24\",\n          \"stroke-width\": \"2\",\n          stroke: \"currentColor\",\n          fill: \"none\",\n          \"stroke-linecap\": \"round\",\n          \"stroke-linejoin\": \"round\",\n          children: [/*#__PURE__*/_jsxDEV(\"path\", {\n            stroke: \"none\",\n            d: \"M0 0h24v24H0z\",\n            fill: \"none\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 684,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n            d: \"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 685,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"rect\", {\n            x: \"3\",\n            y: \"6\",\n            width: \"12\",\n            height: \"12\",\n            rx: \"2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 686,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n            x1: \"7\",\n            y1: \"12\",\n            x2: \"11\",\n            y2: \"12\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 687,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n            x1: \"9\",\n            y1: \"10\",\n            x2: \"9\",\n            y2: \"14\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 688,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 672,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 671,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 670,\n      columnNumber: 7\n    }, this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(\"a\", {\n      id: \"disableVideo\",\n      onClick: () => self.unPublishCamera(),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          float: \"right\",\n          paddingTop: \"1px\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"svg\", {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          class: \"icon\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 24 24\",\n          \"stroke-width\": \"2\",\n          stroke: \"currentColor\",\n          fill: \"none\",\n          \"stroke-linecap\": \"round\",\n          \"stroke-linejoin\": \"round\",\n          children: [/*#__PURE__*/_jsxDEV(\"path\", {\n            stroke: \"none\",\n            d: \"M0 0h24v24H0z\",\n            fill: \"none\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 709,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n            x1: \"3\",\n            y1: \"3\",\n            x2: \"21\",\n            y2: \"21\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 710,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n            d: \"M15 11v-1l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -.675 .946\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 711,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n            d: \"M10 6h3a2 2 0 0 1 2 2v3m0 4v1a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2v-8a2 2 0 0 1 2 -2h1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 712,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 697,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 696,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 695,\n      columnNumber: 7\n    }, this);\n  }\n}\n\nfunction initDevices(devices) {\n  var self = this;\n  navigator.mediaDevices.enumerateDevices().then(function (devices) {\n    devices.forEach(function (device) {\n      console.log(device.kind);\n\n      if (device.kind === 'audiooutput') {\n        $('#speakerSelect').append(\"<option value='\" + device.deviceId + \"'>\" + device.label + \"</option>\");\n      }\n\n      if (device.kind === 'audioinput') {\n        $('#audioSourceSelect').append(\"<option value='\" + device.deviceId + \"'>\" + device.label + \"</option>\");\n      }\n\n      if (device.kind === 'videoinput') {\n        $('#videoSourceSelect').append(\"<option value='\" + device.deviceId + \"'>\" + device.label + \"</option>\");\n      }\n    });\n  }).catch(function (err) {\n    console.log(err.name + \": \" + err.message);\n  });\n}","map":{"version":3,"sources":["/Users/hosseinshafiei/Projects/ecollab/client/src/components/rooms/janus-videoroom.js"],"names":["Janus","React","Component","$","socket","vsessionCreate","room","self","init","debug","callback","janus","server","state","success","attach","plugin","opaqueId","pluginHandle","setState","sfutest","log","getPlugin","getId","vregisterUsername","initDevices","error","consentDialog","on","iceState","mediaState","medium","webrtcState","onmessage","msg","jsep","event","myVroomId","vJoined","addParticipant","fullname","userUUID","reloadParams","ionRequestRoom","list","f","console","id","display","audio","video","vAddParticipant","vNewRemoteFeed","warn","leaving","feeds","filter","item","rfid","unPublishedFeed","remoteFeed","shift","detach","removeParticipant","unpublished","hangup","vStreamDettacher","handleRemoteJsep","onlocalstream","stream","exisiting","length","concat","videoTracks","getVideoTracks","vparticipants","vStreamAttacher","onremotestream","oncleanup","params","publishedCamera","slot","muted","bar","getJsonFromUrl","$f7","view","history","window","location","replace","destroyed","reload","simulcastStarted","subscribe","request","ptype","pin","feed","private_id","mypvtid","webRTCAdapter","browserDetails","browser","safariVp8","toUpperCase","participantId","split","roomId","propagate","propagates","availableFeeds","send","message","uuid","alert","rfdisplay","createAnswer","media","audioSend","videoSend","data","body","vremoveParticipant","ondata","register","userColor","vChangeUsername","localVideo","document","createElement","autoplay","width","show","webrtcStuff","remoteStream","vActive","append","attachMediaStream","getElementById","myStream","hide","p","participant","exisitingParticipant","role","current","publishCamera","bitrate","deviceId","device","isAdmin","height","exact","createOffer","audioRecv","videoRecv","publish","bitrate_cap","$$","emit","tracks","getTracks","unPublishCamera","unpublish","videoState","toggleVideoDevice","vexisitingParticipant","vparticipantDisplay","vparticipantChangeStatus","status","prevState","talking","vparticipantChangeRoom","participantRoom","vexitAudioRoom","mixertest","vPublishBtn","float","paddingTop","devices","navigator","mediaDevices","enumerateDevices","then","forEach","kind","label","catch","err","name"],"mappings":"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","sourcesContent":["import Janus from \"../../janus-2021.js\";\nimport React, { Component } from \"react\";\nimport $ from \"jquery\";\nimport { socket } from \"../../socket.js\";\n\nexport function vsessionCreate(room) {\n  var self = this;\n  Janus.init({\n    debug: \"all\",\n    callback: function () {\n      // Create session\n      var janus = new Janus({\n        server: self.state.server,\n        success: function () {\n          // Attach to VideoRoom plugin\n          janus.attach({\n            plugin: \"janus.plugin.videoroom\",\n            opaqueId: self.state.opaqueId,\n            success: function (pluginHandle) {\n              //sfutest = pluginHandle;\n              self.setState({ janus: janus });\n              self.setState({ sfutest: pluginHandle });\n              Janus.log(\n                \"Plugin attached! (\" +\n                  self.state.sfutest.getPlugin() +\n                  \", id=\" +\n                  self.state.sfutest.getId() +\n                  \")\"\n              );\n              Janus.log(\"  -- This is a publisher/manager\");\n              self.vregisterUsername(room);\n              initDevices()\n              // Prepare the username registration\n            },\n            error: function (error) {\n              Janus.error(\"  -- Error attaching plugin...\", error);\n            },\n            consentDialog: function (on) {\n              Janus.debug(\n                \"Consent dialog should be \" + (on ? \"on\" : \"off\") + \" now\"\n              );\n            },\n            iceState: function (state) {\n              Janus.log(\"ICE state changed to \" + state);\n            },\n            mediaState: function (medium, on) {\n              Janus.log(\n                \"Janus \" +\n                  (on ? \"started\" : \"stopped\") +\n                  \" receiving our \" +\n                  medium\n              );\n            },\n            webrtcState: function (on) {\n              Janus.log(\n                \"Janus says our WebRTC PeerConnection is \" +\n                  (on ? \"up\" : \"down\") +\n                  \" now\"\n              );\n            },\n            onmessage: function (msg, jsep) {\n              Janus.debug(\" ::: Got a message (publisher) :::\", msg);\n              var event = msg[\"videoroom\"];\n              Janus.debug(\"Event: \" + event);\n              if (event) {\n                if (event === \"joined\") {\n                  // Publisher/manager created, negotiate WebRTC and attach to existing feeds, if any\n                  //myid = msg[\"id\"];\n                  //mypvtid = msg[\"private_id\"];\n                  self.setState({\n                    myVroomId: msg[\"id\"],\n                    vJoined: true,\n                  });\n                  Janus.log(\n                    \"Successfully joined room \" +\n                      msg[\"room\"] +\n                      \" with ID \" +\n                      msg[\"id\"]\n                  );\n                  self.addParticipant(\n                    msg[\"id\"],\n                    self.state.fullname + \"ยง\" + self.state.userUUID\n                  );\n                  if (\n                    self.state.reloadParams &&\n                    self.state.reloadParams[\"cam\"]\n                  ) {\n                    self.ionRequestRoom();\n                  }\n                  //publishOwnFeed(true);\n                  //}\n                  // Any new feed to attach to?\n                  if (msg[\"publishers\"]) {\n                    var list = msg[\"publishers\"];\n                    Janus.debug(\n                      \"Got a list of available publishers/feeds:\",\n                      list\n                    );\n                    for (var f in list) {\n                      console.log(\"List >>\", list);\n                      var id = list[f][\"id\"];\n                      var display = list[f][\"display\"];\n                      var audio = list[f][\"audio_codec\"];\n                      var video = list[f][\"video_codec\"];\n                      Janus.debug(\n                        \"  >> [\" +\n                          id +\n                          \"] \" +\n                          display +\n                          \" (audio: \" +\n                          audio +\n                          \", video: \" +\n                          video +\n                          \")\"\n                      );\n                      self.vAddParticipant(list[f][\"id\"], list[f][\"display\"]);\n                      self.vNewRemoteFeed(id, display, audio, video);\n                    }\n                  }\n                } else if (event === \"destroyed\") {\n                  // The room has been destroyed\n                  Janus.warn(\"The room has been destroyed!\");\n                } else if (event === \"event\") {\n                  // Any new feed to attach to?\n                  if (msg[\"publishers\"]) {\n                    var list = msg[\"publishers\"];\n                    Janus.debug(\n                      \"Got a list of available publishers/feeds:\",\n                      list\n                    );\n                    for (var f in list) {\n                      var id = list[f][\"id\"];\n                      var display = list[f][\"display\"];\n                      var audio = list[f][\"audio_codec\"];\n                      var video = list[f][\"video_codec\"];\n                      console.log(list);\n                      Janus.debug(\n                        \"  >> [\" +\n                          id +\n                          \"] \" +\n                          display +\n                          \" (audio: \" +\n                          audio +\n                          \", video: \" +\n                          video +\n                          \")\"\n                      );\n                      self.vAddParticipant(list[f][\"id\"], list[f][\"display\"]);\n                      self.vNewRemoteFeed(id, display, audio, video);\n                    }\n                  } else if (msg[\"leaving\"]) {\n                    // One of the publishers has gone away?\n                    var leaving = msg[\"leaving\"];\n                    console.log(\"Publisher leaving: \" + leaving);\n                    self.setState(\n                      {\n                        feeds: self.state.feeds.filter(\n                          (item) => item.rfid != leaving\n                        ),\n                      },\n                      () => console.log(\"feeds: >>>>\", self.state.feeds)\n                    );\n                    var unPublishedFeed = self.state.feeds.filter(\n                      (item) => item.rfid === leaving\n                    );\n                    var remoteFeed = unPublishedFeed.shift();\n                    if (remoteFeed != null) {\n                      remoteFeed.detach();\n                    }\n                    self.removeParticipant(leaving);\n                  } else if (msg[\"unpublished\"]) {\n                    // One of the publishers has unpublished?\n                    var unpublished = msg[\"unpublished\"];\n                    console.log(\"Publisher left: \" + unpublished);\n                    if (unpublished === \"ok\") {\n                      self.state.sfutest.hangup();\n                      self.vStreamDettacher(self.state.sfutest);\n                      return;\n                    }\n                    var unPublishedFeed = self.state.feeds.filter(\n                      (item) => item.rfid === unpublished\n                    );\n                    var remoteFeed = unPublishedFeed.shift();\n                    if (remoteFeed != null) {\n                      remoteFeed.detach();\n                      self.vStreamDettacher(remoteFeed);\n                    }\n                    self.removeParticipant(unpublished);\n\n                    self.setState({\n                      feeds: self.state.feeds.filter(\n                        (item) => item.rfid != unpublished\n                      ),\n                    });\n                  } else if (msg[\"error\"]) {\n                    if (msg[\"error_code\"] === 426) {\n                      // This is a \"no such room\" error: give a more meaningful description\n                    } else {\n                    }\n                  }\n                }\n              }\n              if (jsep) {\n                Janus.debug(\"Handling SDP as well...\", jsep);\n                self.state.sfutest.handleRemoteJsep({ jsep: jsep });\n              }\n            },\n            onlocalstream: function (stream) {\n              Janus.debug(\" ::: Got a local stream :::\", stream);\n              console.log(\" ::: Got a local stream :::\", stream);\n              console.log(self.state.sfutest.id);\n              var exisiting = self.state.feeds.filter(\n                (item) => item.id === self.state.sfutest.id\n              );\n              if (exisiting.length === 0) {\n                self.state.sfutest.rfid = self.state.myVroomId;\n                self.setState({\n                  feeds: self.state.feeds.concat(self.state.sfutest),\n                });\n              }\n\n              var videoTracks = stream.getVideoTracks();\n\n              if (!videoTracks || videoTracks.length === 0) {\n                self.vStreamDettacher(self.state.sfutest);\n              } else {\n                console.log(self.state.vparticipants);\n                self.vStreamAttacher(self.state.sfutest);\n              }\n            },\n            onremotestream: function (stream) {\n              // The publisher stream is sendonly, we don't expect anything here\n            },\n            oncleanup: function () {\n              Janus.log(\n                \" ::: Got a cleanup notification: we are unpublished now :::\"\n              );\n            },\n          });\n        },\n        error: function (error) {\n          Janus.error(error);\n          //bootbox.alert(error, function() {\n          var params = \"\";\n          if (self.state.publishedCamera) {\n            params = params + \"?cam=true&roomId=\" + self.state.slot;\n          }\n          if (!self.state.muted) {\n            params = params + \"&mic=true\";\n          }\n          if (params === \"\") {\n            var bar = self.getJsonFromUrl(self.$f7.view[0].history[0]);\n            params = params + \"?cam=\" + bar[\"cam\"] + \"&mic=\" + bar[\"mic\"];\n          }\n          //console.log('%%%%%%%%%%%%%%%', params)\n          window.location.replace(\"http://localhost:3000/\" + params);\n          //});\n        },\n        destroyed: function () {\n          window.location.reload();\n        },\n      });\n    },\n  });\n}\n\nexport function vNewRemoteFeed(id, feeds, display, audio, video) {\n  var self = this;\n  // A new feed has been published, create a new plugin handle and attach to it as a subscriber\n  var remoteFeed = null;\n  self.state.janus.attach({\n    plugin: \"janus.plugin.videoroom\",\n    opaqueId: this.state.opaqueId,\n    success: function (pluginHandle) {\n      remoteFeed = pluginHandle;\n      remoteFeed.simulcastStarted = false;\n      Janus.log(\n        \"Plugin attached! (\" +\n          remoteFeed.getPlugin() +\n          \", id=\" +\n          remoteFeed.getId() +\n          \")\"\n      );\n      Janus.log(\"  -- This is a subscriber\");\n      // We wait for the plugin to send us an offer\n      var subscribe = {\n        request: \"join\",\n        room: 1234,\n        ptype: \"subscriber\",\n        pin: self.state.pin,\n        feed: id,\n        private_id: self.state.mypvtid,\n      };\n      // In case you don't want to receive audio, video or data, even if the\n      // publisher is sending them, set the 'offer_audio', 'offer_video' or\n      // 'offer_data' properties to false (they're true by default), e.g.:\n      // \t\tsubscribe[\"offer_video\"] = false;\n      // For example, if the publisher is VP8 and this is Safari, let's avoid video\n      if (\n        Janus.webRTCAdapter.browserDetails.browser === \"safari\" &&\n        (video === \"vp9\" || (video === \"vp8\" && !Janus.safariVp8))\n      ) {\n        if (video) video = video.toUpperCase();\n        console.log(\n          \"Publisher is using \" +\n            video +\n            \", but Safari doesn't support it: disabling video\"\n        );\n        subscribe[\"offer_video\"] = false;\n      }\n      //subscribe[\"offer_video\"] = false;\n      //remoteFeed.videoCodec = video;\n      //var participantId = display.split(\"ยง\")[1]\n      //var propagate = self.state.propagates.filter((item) => item === participantId)\n      if (feeds) {\n        //name should be display !!\n        var participantId = feeds.split(\"ยง\")[1];\n        var roomId = feeds.split(\"ยง\")[feeds.split(\"ยง\").length - 1];\n        var propagate = self.state.propagates.filter(\n          (item) => item === participantId\n        );\n        self.setState({\n          availableFeeds: self.state.availableFeeds.filter(\n            (item) => item.id === id\n          ),\n        });\n        console.log(self.state.availableFeeds);\n        if ((propagate && propagate[0]) || roomId === \"0\") {\n          remoteFeed.send({ message: subscribe });\n        } else {\n          self.setState({\n            availableFeeds: self.state.availableFeeds.concat({\n              id: id,\n              display: feeds,\n              uuid: participantId,\n              video: video,\n            }),\n          });\n        }\n      }\n    },\n    error: function (error) {\n      Janus.error(\"  -- Error attaching plugin...\", error);\n      window.alert(\"Error attaching plugin... \" + error);\n    },\n    onmessage: function (msg, jsep) {\n      Janus.debug(\" ::: Got a message (subscriber) :::\", msg);\n      var event = msg[\"videoroom\"];\n      Janus.log(\"Event: \" + event);\n\n      if (msg[\"error\"]) {\n        window.alert(msg[\"error\"]);\n      } else if (event) {\n        if (event === \"attached\") {\n          remoteFeed.rfid = msg[\"id\"];\n          remoteFeed.rfdisplay = msg[\"display\"];\n          self.setState({ feeds: self.state.feeds.concat(remoteFeed) }, () =>\n            console.log(\"@@@@\", self.state.feeds)\n          );\n\n          if (!video) {\n            self.vStreamDettacher(remoteFeed);\n          }\n\n          Janus.log(\n            \"Successfully attached to feed \" +\n              remoteFeed.rfid +\n              \" (\" +\n              remoteFeed.rfdisplay +\n              \") in room \" +\n              msg[\"room\"]\n          );\n        } else if (event === \"event\") {\n        } else {\n          // What has just happened?\n        }\n      }\n      if (jsep) {\n        Janus.log(\"Handling SDP as well...\", jsep);\n        remoteFeed.createAnswer({\n          jsep: jsep,\n          // Add data:true here if you want to subscribe to datachannels as well\n          // (obviously only works if the publisher offered them in the first place)\n          media: { audioSend: false, videoSend: false, data: false }, // We want recvonly audio/video\n          success: function (jsep) {\n            Janus.log(\"Got SDP!\", jsep);\n            var body = { request: \"start\", room: self.state.roomId };\n            remoteFeed.send({ message: body, jsep: jsep });\n          },\n          error: function (error) {\n            Janus.log(\"WebRTC error:\", error);\n            window.alert(\"WebRTC error... \" + error.message);\n          },\n        });\n      }\n    },\n    iceState: function (state) {\n      Janus.log(\n        \"ICE state of this WebRTC PeerConnection (feed #\" +\n          remoteFeed.rfid +\n          \") changed to \" +\n          state\n      );\n    },\n    webrtcState: function (on) {\n      Janus.log(\n        \"Janus says this WebRTC PeerConnection (feed #\" +\n          remoteFeed.rfid +\n          \") is \" +\n          (on ? \"up\" : \"down\") +\n          \" now\"\n      );\n      if (on === \"down\") {\n        self.vremoveParticipant(remoteFeed.rfid);\n      }\n    },\n    onlocalstream: function (stream) {\n      console.log(\">>>>>>>>>>>\", stream);\n    },\n    onremotestream: function (stream) {\n      self.vStreamAttacher(remoteFeed);\n    },\n    ondata: function (data) {},\n    oncleanup: function () {\n      Janus.log(\" ::: Got a cleanup notification (remote feed \" + id + \") :::\");\n    },\n  });\n}\n\nexport function vregisterUsername(room) {\n  var self = this;\n  var register = {\n    request: \"join\",\n    room: 1234,\n    ptype: \"publisher\",\n    //pin: self.state.pin,\n    display:\n      self.state.fullname +\n      \" ยง\" +\n      self.state.userUUID +\n      \"ยง\" +\n      self.state.userColor +\n      \"ยง\" +\n      self.state.slot,\n  };\n  self.state.sfutest.send({ message: register });\n  //self.setState({ myVroomId: self.state.mixertest.id });\n}\n\nexport function vChangeUsername(room) {\n  var self = this;\n  var register = {\n    request: \"configure\",\n    room: 1234,\n    ptype: \"publisher\",\n    //pin: self.state.pin,\n    display:\n      self.state.fullname +\n      \" ยง\" +\n      self.state.userUUID +\n      \"ยง\" +\n      self.state.userColor +\n      \"ยง\" +\n      self.state.slot,\n  };\n  self.state.sfutest.send({ message: register });\n  //self.setState({ myVroomId: self.state.mixertest.id });\n}\n\nexport function vStreamAttacher(feed) {\n  var self = this;\n  console.log(\"Attaching \" + feed.id);\n  console.log($(\"#video-\" + feed.id));\n  if ($(\"#video-\" + feed.id).length == 0) {\n    var localVideo = document.createElement(\"video\");\n    localVideo.autoplay = true;\n    localVideo.muted = true;\n    localVideo.width = \"320\";\n    localVideo.id = \"video-\" + feed.id;\n  }\n  $(\"#video-\" + feed.id).show();\n  if (feed.id && feed.webrtcStuff && feed.webrtcStuff.remoteStream) {\n    self.setState({ vActive: true });\n    if (localVideo) $(\"#remoteVideos\").append(localVideo);\n    Janus.attachMediaStream(\n      document.getElementById(\"video-\" + feed.id),\n      feed.webrtcStuff.remoteStream\n    );\n  }\n  if (feed.id && feed.webrtcStuff && feed.webrtcStuff.myStream) {\n    if (localVideo) $(\"#selfVideos\").append(localVideo);\n    $(\"#videoLoaderIcon\").hide();\n    $(\"#videoLoaderIcon2\").hide();\n    \n    $(\"#disableVideo\").show();\n    Janus.attachMediaStream(\n      document.getElementById(\"video-\" + feed.id),\n      feed.webrtcStuff.myStream\n    );\n  }\n}\n\nexport function vStreamDettacher(feed) {\n  if (feed.id) {\n    console.log(\"Dettaching \" + feed.id);\n    $(\"#video-\" + feed.id).hide();\n  }\n}\n\nexport function vremoveParticipant(id) {\n  var self = this;\n  self.setState({\n    vparticipants: self.state.vparticipants.filter((item) => item.id !== id),\n  });\n}\n\nexport function vAddParticipant(id, p) {\n  //console.log(\"Adding Participants ...\", id, p);\n  var self = this;\n  var participant = p.split(\"ยง\");\n  if (this.exisitingParticipant(participant[1])) {\n    self.setState({\n      vparticipants: self.state.vparticipants.concat({\n        id: id,\n        display: participant[0],\n        uuid: participant[1],\n        userColor: participant[2],\n        role: \"listener\",\n        current: \"stopped-talking\",\n      }),\n    });\n  }\n  //console.log(\"participant added:\", participant[1]);\n}\n\nexport function publishCamera(bitrate = 16, deviceId = null) {\n  var self = this;\n  var video = true;\n  var device = true;\n  if (!self.state.isAdmin) {\n    video = { width: 180, height: 151 };\n    \n  } \n  if (self.state.slot === '0') {\n    video = \"hires-16:9\"\n  }\n  if(deviceId){\n    device = {deviceId: { exact: deviceId}}\n  }\n  self.state.sfutest.createOffer({\n    media: {\n      audioRecv: false,\n      videoRecv: false,\n      data: false,\n      videoSend: true,\n      audioSend: false,\n      video: video,\n      video: device,\n    },\n\n    success: function (jsep) {\n      Janus.debug(\"********* Got publisher SDP!\", jsep);\n      console.log(\"switching to \" + bitrate);\n      if (jsep) {\n        var publish = {\n          request: \"configure\",\n          audio: false,\n          video: true,\n          //video:{width: 180, height: 180},\n          data: false,\n          bitrate: bitrate * 8000,\n          bitrate_cap: true,\n          //videocodec: \"vp8\",\n        };\n        self.state.sfutest.send({ message: publish, jsep: jsep });\n      }\n      self.setState({ publishedCamera: true });\n      self.$$(\"#disableVideo\").show();\n      self.$$(\"#dVideo\").show();\n      console.log(\"ID: >>>\", self.state.sfutest.id);\n      socket.emit(\"ionSetSlot\", {\n        slot: self.state.slot,\n        stream: self.state.sfutest.id,\n      });\n      var tracks = self.state.sfutest.webrtcStuff.myStream.getTracks();\n      console.log(tracks);\n    },\n    error: function (error) {\n      Janus.error(\"***** WebRTC error:\", error);\n    },\n  });\n}\n\nexport function unPublishCamera() {\n  var self = this;\n  console.log(\"unPublishing ..\");\n  var unpublish = { request: \"unpublish\" };\n  self.state.sfutest.send({ message: unpublish });\n  self.vStreamDettacher(self.state.sfutest);\n  console.log(\"ID: >>>\", self.state.sfutest.id);\n  socket.emit(\"ionRelSlot\", {\n    slot: self.state.slot,\n    stream: self.state.sfutest.id,\n  });\n  self.setState({ publishedCamera: false, videoState: \"initial\", slot: null });\n}\n\nexport function toggleVideoDevice(deviceId){\n  var self = this;\n  if (self.state.publishedCamera) {\n    self.unPublishCamera();\n  }\n  self.publishCamera(16, deviceId)\n}\n\nexport function vexisitingParticipant(participantId) {\n  var self = this;\n  var exisiting = self.state.vparticipants.filter(\n    (item) => item.uuid === participantId\n  );\n  if (exisiting.length === 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nexport function vparticipantDisplay(participantId) {\n  var self = this;\n  var exisiting = self.state.vparticipants.filter(\n    (item) => item.uuid === participantId\n  );\n  if (exisiting.length === 0) {\n    return \"\";\n  } else {\n    return exisiting[0].display;\n  }\n}\n\nexport function vparticipantChangeStatus(participantId, status) {\n  this.setState((prevState) => ({\n    talking: {\n      ...prevState.talking,\n      [participantId]: status,\n    },\n  }));\n}\n\nexport function vparticipantChangeRoom(participantId, room) {\n  this.setState((prevState) => ({\n    participantRoom: {\n      ...prevState.participantRoom,\n      [participantId]: room,\n    },\n  }));\n}\n\nexport function vexitAudioRoom() {\n  var self = this;\n  if (this.state.mixertest) {\n    this.state.mixertest.send({ message: { request: \"unpublish\" } });\n  }\n}\n\n\nexport function vPublishBtn() {\n  var self = this;\n  if (!self.state.publishedCamera) {\n    return (\n      <a id=\"enableVideo\" fill onClick={() => self.ionRequestRoom()}>\n        <div style={{ float: \"right\", paddingTop: \"3px\" }}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            class=\"icon\"\n            width=\"18\"\n            height=\"18\"\n            viewBox=\"0 0 24 24\"\n            stroke-width=\"2\"\n            stroke=\"currentColor\"\n            fill=\"none\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          >\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\n            <path d=\"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z\" />\n            <rect x=\"3\" y=\"6\" width=\"12\" height=\"12\" rx=\"2\" />\n            <line x1=\"7\" y1=\"12\" x2=\"11\" y2=\"12\" />\n            <line x1=\"9\" y1=\"10\" x2=\"9\" y2=\"14\" />\n          </svg>\n        </div>\n      </a>\n    );\n  } else {\n    return (\n      <a id=\"disableVideo\" onClick={() => self.unPublishCamera()}>\n        <div style={{ float: \"right\", paddingTop: \"1px\" }}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            class=\"icon\"\n            width=\"16\"\n            height=\"16\"\n            viewBox=\"0 0 24 24\"\n            stroke-width=\"2\"\n            stroke=\"currentColor\"\n            fill=\"none\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          >\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\n            <line x1=\"3\" y1=\"3\" x2=\"21\" y2=\"21\" />\n            <path d=\"M15 11v-1l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -.675 .946\" />\n            <path d=\"M10 6h3a2 2 0 0 1 2 2v3m0 4v1a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2v-8a2 2 0 0 1 2 -2h1\" />\n          </svg>\n        </div>\n      </a>\n    );\n  }\n}\n\nfunction initDevices(devices) {\n  var self = this;\n  navigator.mediaDevices.enumerateDevices()\n  .then(function(devices) {\n    devices.forEach(function(device) {\n      console.log(device.kind)\n      if(device.kind === 'audiooutput') {\n        $('#speakerSelect').append(\"<option value='\"+device.deviceId+\"'>\"+device.label+\"</option>\")\n       }\n       if(device.kind === 'audioinput') {\n        $('#audioSourceSelect').append(\"<option value='\"+device.deviceId+\"'>\"+device.label+\"</option>\")\n       }\n       if(device.kind === 'videoinput') {\n        $('#videoSourceSelect').append(\"<option value='\"+device.deviceId+\"'>\"+device.label+\"</option>\")\n       }\n    });\n  })\n  .catch(function(err) {\n    console.log(err.name + \": \" + err.message);\n  });\n}\n"]},"metadata":{},"sourceType":"module"}